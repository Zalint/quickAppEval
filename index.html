<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infographie: Analyse Comparative des Ventes de B≈ìuf</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .kpi-value {
            font-weight: 900;
            color: #073B4C;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

        <header class="text-center my-12">
            <h1 class="text-4xl md:text-5xl font-black text-[#073B4C] leading-tight">Prix vs. Volume : La Bataille pour la Rentabilit√©</h1>
            <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Une analyse comparative de deux strat√©gies de vente de b≈ìuf pour d√©couvrir laquelle g√©n√®re le plus de profits.</p>
        </header>

        <main>
            <section id="inputs" class="mb-16 bg-white p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-6 text-[#073B4C]">Param√®tres de Simulation</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto">
                    <div>
                        <label for="costPerKg" class="block text-sm font-medium text-slate-700 mb-1">Prix d'Achat (FCFA/kg)</label>
                        <input type="number" id="costPerKg" value="3350" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#06D6A0] focus:ring-[#06D6A0] text-lg p-2">
                    </div>
                    <div>
                        <label for="priceA" class="block text-sm font-medium text-slate-700 mb-1">Prix de Vente Point A (FCFA/kg)</label>
                        <input type="number" id="priceA" value="3900" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#118AB2] focus:ring-[#118AB2] text-lg p-2">
                    </div>
                    <div>
                        <label for="priceB" class="block text-sm font-medium text-slate-700 mb-1">Prix de Vente Point B (FCFA/kg)</label>
                        <input type="number" id="priceB" value="3700" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#FF6B6B] focus:ring-[#FF6B6B] text-lg p-2">
                    </div>
                    <div>
                        <label for="initialSalesVolume" class="block text-sm font-medium text-slate-700 mb-1">Chiffre d'Affaires Mensuel (FCFA)</label>
                        <input type="number" id="initialSalesVolume" value="7000000" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#FFD166] focus:ring-[#FFD166] text-lg p-2">
                    </div>
                    <div>
                        <label for="salaries" class="block text-sm font-medium text-slate-700 mb-1">Charges Salariales Mensuelles (FCFA)</label>
                        <input type="number" id="salaries" value="250000" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#FFD166] focus:ring-[#FFD166] text-lg p-2">
                    </div>
                    <div>
                        <label for="rent" class="block text-sm font-medium text-slate-700 mb-1">Loyer Mensuel (FCFA)</label>
                        <input type="number" id="rent" value="100000" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#FFD166] focus:ring-[#FFD166] text-lg p-2">
                    </div>
                     <div>
                        <label for="perte" class="block text-sm font-medium text-slate-700 mb-1">Perte (D√©coupe & Commercialisation) (%)</label>
                        <input type="number" id="perte" value="14.4" min="0" max="99" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#06D6A0] focus:ring-[#06D6A0] text-lg p-2">
                    </div>
                    <div>
                        <label for="byProductRevenuePerKgReceived" class="block text-sm font-medium text-slate-700 mb-1">Revenus des sous-produits (FCFA/kg re√ßu)</label>
                        <input type="number" id="byProductRevenuePerKgReceived" value="313.0" min="0" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#06D6A0] focus:ring-[#06D6A0] text-lg p-2">
                    </div>
                    <div>
                        <label for="otherCharges" class="block text-sm font-medium text-slate-700 mb-1">Autre Charge Mensuelle (FCFA)</label>
                        <input type="number" id="otherCharges" value="0" min="0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-[#FFD166] focus:ring-[#FFD166] text-lg p-2">
                    </div>
                     <div>
                        <label for="effectivePerte" class="block text-sm font-medium text-slate-700 mb-1">Perte effective (%)</label>
                        <p id="effectivePerte" class="mt-1 block w-full text-lg p-2 text-slate-800 font-bold">0.0%</p>
                    </div>
                </div>
            </section>

            <section id="snapshot" class="mb-16">
                <h2 class="text-3xl font-bold text-center mb-2 text-[#073B4C]">Performance Actuelle (CA de <span id="currentSalesVolumeDisplay">7M</span> FCFA)</h2>
                <p class="text-center text-slate-600 mb-10">√Ä volume de chiffre d'affaires √©gal, la strat√©gie de prix premium du Point A se d√©tache nettement.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                    <div class="space-y-6">
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-l-8 border-[#118AB2]">
                            <h3 class="font-bold text-xl text-[#073B4C]">Point de Vente A (Prix Haut)</h3>
                            <p class="text-slate-500 mb-2">B√©n√©fice Net</p>
                            <p id="netProfitA" class="text-5xl kpi-value">637 250 <span class="text-3xl font-semibold">FCFA</span></p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-l-8 border-[#FF6B6B]">
                            <h3 class="font-bold text-xl text-[#073B4C]">Point de Vente B (Volume Bas)</h3>
                            <p class="text-slate-500 mb-2">B√©n√©fice Net</p>
                            <p id="netProfitB" class="text-5xl kpi-value">312 200 <span class="text-3xl font-semibold">FCFA</span></p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                         <p class="text-center mt-4 text-sm text-slate-500">Le Point A g√©n√®re plus du double du b√©n√©fice net du Point B.</p>
                    </div>
                </div>
            </section>
            
            <section id="challenge" class="bg-[#073B4C] text-white py-16 rounded-2xl shadow-xl my-16 text-center">
                 <h2 class="text-3xl font-bold mb-4 text-[#FFD166]">Le D√©fi du Point de Vente B</h2>
                 <p class="text-slate-300 max-w-2xl mx-auto mb-6">Pour √©galer le b√©n√©fice du Point A, le Point B ne doit pas seulement vendre plus, il doit augmenter son volume de ventes de mani√®re spectaculaire.</p>
                 <div id="requiredIncreaseB" class="text-8xl font-black text-white">
                     +49%
                 </div>
                 <p class="mt-2 text-xl text-slate-300">d'augmentation de volume requise.</p>
            </section>

            <section id="projection" class="my-16">
                <h2 class="text-3xl font-bold text-center mb-2 text-[#073B4C]">Projection de Rentabilit√© par Volume</h2>
                <p class="text-center text-slate-600 mb-10">La strat√©gie de marge √©lev√©e du Point A continue de surperformer √† mesure que le volume des ventes augmente.</p>
                <div class="bg-white p-6 rounded-2xl shadow-lg md:col-span-2">
                    <div class="chart-container h-[400px] max-h-[500px]">
                        <canvas id="projectionChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-slate-500">L'√©cart de profit se creuse avec l'augmentation du chiffre d'affaires.</p>
                </div>
            </section>

            <section id="cost-challenge-chart" class="my-16">
                <h2 class="text-3xl font-bold text-center mb-2 text-[#073B4C]">D√©fi du Point B en fonction du Prix d'Achat</h2>
                <p class="text-center text-slate-600 mb-10">Visualisez comment le pourcentage d'augmentation de volume n√©cessaire pour le Point B varie avec le prix d'achat du kilo.</p>
                <div class="bg-white p-6 rounded-2xl shadow-lg md:col-span-2">
                    <div class="chart-container h-[400px] max-h-[500px]">
                        <canvas id="challengeByCostChart"></canvas>
                    </div>
                    <p class="text-center mt-4 text-sm text-slate-500">Un prix d'achat plus √©lev√© rend le d√©fi du Point B plus difficile.</p>
                </div>
            </section>

            <section id="breakdown" class="my-16">
                <h2 class="text-3xl font-bold text-center mb-2 text-[#073B4C]">Anatomie de la Marge par Kilogramme</h2>
                <p class="text-center text-slate-600 mb-10">La diff√©rence de rentabilit√© r√©side dans la composition du prix de vente de chaque point de vente.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                         <h3 class="text-xl font-bold text-center mb-4 text-[#118AB2]">Point de Vente A</h3>
                        <div class="chart-container">
                            <canvas id="breakdownAChart"></canvas>
                        </div>
                        <p id="marginA" class="text-center mt-4 text-sm text-slate-500">Une marge unitaire forte de 550 FCFA/kg.</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold text-center mb-4 text-[#FF6B6B]">Point de Vente B</h3>
                        <div class="chart-container">
                            <canvas id="breakdownBChart"></canvas>
                        </div>
                         <p id="marginB" class="text-center mt-4 text-sm text-slate-500">Une marge unitaire plus faible de 350 FCFA/kg.</p>
                    </div>
                </div>
            </section>

            <section id="annual-projection" class="my-16 bg-[#06D6A0] text-white py-16 rounded-2xl shadow-xl text-center">
                <h2 class="text-3xl font-bold mb-4 text-[#073B4C]">Projection Annuelle de Rentabilit√©</h2>
                <p class="text-slate-100 max-w-2xl mx-auto mb-8">En extrapolant les b√©n√©fices mensuels actuels sur une ann√©e compl√®te, nous pouvons anticiper la performance financi√®re √† long terme.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-3xl mx-auto">
                    <div class="bg-white p-6 rounded-2xl shadow-lg text-[#073B4C]">
                        <h3 class="font-bold text-xl mb-2">B√©n√©fice Annuel Point A</h3>
                        <p id="annualProfitA" class="text-5xl kpi-value">0 <span class="text-3xl font-semibold">FCFA</span></p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg text-[#073B4C]">
                        <h3 class="font-bold text-xl mb-2">B√©n√©fice Annuel Point B</h3>
                        <p id="annualProfitB" class="text-5xl kpi-value">0 <span class="text-3xl font-semibold">FCFA</span></p>
                    </div>
                </div>
                <p class="mt-6 text-sm text-slate-100">Ces projections sont bas√©es sur les param√®tres de simulation actuels.</p>
            </section>

            <section id="recommendations" class="my-16">
                 <h2 class="text-3xl font-bold text-center mb-10 text-[#073B4C]">Recommandations Strat√©giques</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-8 rounded-2xl shadow-lg border-t-8 border-[#118AB2]">
                        <h3 class="text-2xl font-bold text-[#073B4C] mb-4">üéØ Pour le Point de Vente A</h3>
                        <ul class="space-y-3 list-disc list-inside text-slate-700">
                            <li><strong>Maintenir le prix premium</strong> en continuant de justifier la valeur par la qualit√© et le service.</li>
                            <li><strong>Optimiser les co√ªts op√©rationnels</strong> pour augmenter encore la marge nette.</li>
                            <li><strong>Investir dans la fid√©lisation</strong> pour s√©curiser la client√®le √† forte valeur.</li>
                        </ul>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg border-t-8 border-[#FF6B6B]">
                        <h3 class="text-2xl font-bold text-[#073B4C] mb-4">üìà Pour le Point de Vente B</h3>
                         <ul class="space-y-3 list-disc list-inside text-slate-700">
                            <li><strong>Prioriser l'augmentation massive du volume</strong> via des actions marketing et promotionnelles agressives.</li>
                            <li><strong>Envisager une l√©g√®re hausse de prix</strong> si possible pour am√©liorer la marge unitaire sans freiner le volume.</li>
                            <li><strong>Am√©liorer l'efficacit√© op√©rationnelle</strong> pour r√©duire les co√ªts fixes et variables.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="hypotheses" class="my-16 bg-white p-8 rounded-2xl shadow-lg">
                <h2 class="text-3xl font-bold text-center mb-6 text-[#073B4C]">Hypoth√®ses et Calculs D√©taill√©s</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-slate-700">
                    <div>
                        <h3 class="text-xl font-bold text-[#073B4C] mb-3">Calcul de la Perte par D√©faut (14.4%)</h3>
                        <p class="text-sm leading-relaxed">Cet historique d√©taille comment la valeur par d√©faut de la perte due √† la d√©coupe et commercialisation a √©t√© √©tablie :</p>
                        <ul class="list-disc list-inside ml-4 mt-2 text-sm leading-relaxed">
                            <li>**B≈ìuf re√ßu (07/03/25) :** 143,5 kg</li>
                            <li>**Quantit√© vendue (7-8-9 mars) :** 122,8 kg</li>
                            <li>**D√©chets relev√©s :** 12,3 kg (compos√© de 0,2 kg + 9 kg + 2,5 kg de "bobette pour merguez" + 0,6 kg)</li>
                            <li>**Quantit√© non vendue au prix principal (d√©chets + disparus) :** 143,5 kg - 122,8 kg = 20,7 kg</li>
                            <li>**Quantit√© disparue :** 20,7 kg - 12,3 kg (d√©chets) = 8,4 kg</li>
                            <li>**Perte en % = (Quantit√© non vendue au prix principal / B≈ìuf re√ßu) * 100**</li>
                            <li>**Perte en % = (20,7 kg / 143,5 kg) * 100 = 14,4%**</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-[#073B4C] mb-3">Calcul des Revenus des Sous-produits par D√©faut (313.0 FCFA/kg re√ßu)</h3>
                        <p class="text-sm leading-relaxed">Ce calcul montre comment la valeur par d√©faut de la r√©cup√©ration de valeur des sous-produits a √©t√© d√©termin√©e :</p>
                        <ul class="list-disc list-inside ml-4 mt-2 text-sm leading-relaxed">
                            <li>**Revenus des d√©chets vendus :** 12,3 kg * 400 FCFA/kg = 4 920 FCFA</li>
                            <li>**Revenus des abats :** 25 000 FCFA</li>
                            <li>**Revenus du foie :** 15 000 FCFA</li>
                            <li>**Total des revenus des sous-produits pour 143,5 kg de b≈ìuf re√ßu :** 4 920 FCFA + 25 000 FCFA + 15 000 FCFA = 44 920 FCFA</li>
                            <li>**Revenus des sous-produits par kg re√ßu = Total des revenus des sous-produits / B≈ìuf re√ßu**</li>
                            <li>**Revenus des sous-produits par kg re√ßu = 44 920 FCFA / 143,5 kg = 313,0 FCFA/kg**</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-16 py-6 border-t border-slate-200">
            <p class="text-sm text-slate-500">&copy; 2025 Analyse Strat√©gique Inc. Tous droits r√©serv√©s.</p>
        </footer>

    </div>

    <script>
        // Register the datalabels plugin globally
        Chart.register(ChartDataLabels);

        const tooltipCallback = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            if (Array.isArray(label)) {
                                return label.join(' ');
                            }
                            return label;
                        }
                    }
                }
            }
        };

        const colors = {
            blue: '#118AB2',
            red: '#FF6B6B',
            green: '#06D6A0',
            darkBlue: '#073B4C',
        };

        let comparisonChart, projectionChart, breakdownAChart, breakdownBChart, challengeByCostChart;

        function calculateMetrics(sellingPrice, totalRevenue, costPerKg, fixedCosts, pertePercentage, byProductRevenuePerKgReceived) {
            const netCostPerKgReceived = costPerKg - byProductRevenuePerKgReceived;
            const effectiveCostPerKgSold = netCostPerKgReceived / (1 - pertePercentage / 100);

            // Check for conditions that make calculations invalid or lead to immediate loss
            if (sellingPrice <= effectiveCostPerKgSold || sellingPrice <= 0 || costPerKg <= 0 || totalRevenue < 0 || fixedCosts < 0 || pertePercentage < 0 || pertePercentage >= 100 || netCostPerKgReceived <= 0) {
                return { quantitySold: 0, unitMargin: 0, grossMargin: -fixedCosts, netProfit: -fixedCosts, effectiveCostPerKgSold: effectiveCostPerKgSold };
            }

            const quantitySold = totalRevenue / sellingPrice; // This is the revenue-generating quantity for the main product
            const unitMargin = sellingPrice - effectiveCostPerKgSold; // Margin per kg *sold*
            const grossMargin = quantitySold * unitMargin;
            const netProfit = grossMargin - fixedCosts;
            return { quantitySold, unitMargin, grossMargin, netProfit, effectiveCostPerKgSold: effectiveCostPerKgSold };
        }

        function updateInfographic() {
            const costPerKg = parseFloat(document.getElementById('costPerKg').value);
            const priceA = parseFloat(document.getElementById('priceA').value);
            const priceB = parseFloat(document.getElementById('priceB').value);
            const initialSalesVolume = parseFloat(document.getElementById('initialSalesVolume').value);
            const salaries = parseFloat(document.getElementById('salaries').value);
            const rent = parseFloat(document.getElementById('rent').value);
            const otherCharges = parseFloat(document.getElementById('otherCharges').value); // Get new input
            const perte = parseFloat(document.getElementById('perte').value);
            const byProductRevenuePerKgReceived = parseFloat(document.getElementById('byProductRevenuePerKgReceived').value);

            const fixedCosts = salaries + rent + otherCharges; // Include new charge

            // Calculate effective costs for min attribute updates
            const effectiveCostA_threshold = (costPerKg - byProductRevenuePerKgReceived) / (1 - perte / 100);
            const effectiveCostB_threshold = (costPerKg - byProductRevenuePerKgReceived) / (1 - perte / 100);

            // Update min attribute for selling prices based on effective cost threshold
            document.getElementById('priceA').min = effectiveCostA_threshold > 0 ? Math.ceil(effectiveCostA_threshold) + 1 : 1;
            document.getElementById('priceB').min = effectiveCostB_threshold > 0 ? Math.ceil(effectiveCostB_threshold) + 1 : 1;

            // Main validation check for displaying "Invalide"
            const netCostPerKgReceived_check = costPerKg - byProductRevenuePerKgReceived;
            const effectiveCostPerKgSold_check = netCostPerKgReceived_check / (1 - perte / 100);

            if (isNaN(costPerKg) || isNaN(priceA) || isNaN(priceB) || isNaN(initialSalesVolume) || isNaN(salaries) || isNaN(rent) || isNaN(otherCharges) || isNaN(perte) || isNaN(byProductRevenuePerKgReceived) || // Added otherCharges
                priceA <= effectiveCostPerKgSold_check || priceB <= effectiveCostPerKgSold_check ||
                costPerKg <= 0 || initialSalesVolume < 0 || salaries < 0 || rent < 0 || otherCharges < 0 || perte < 0 || perte >= 100 || byProductRevenuePerKgReceived < 0 || netCostPerKgReceived_check <= 0) { // Added otherCharges
                
                document.getElementById('netProfitA').textContent = 'Invalide';
                document.getElementById('netProfitB').textContent = 'Invalide';
                document.getElementById('requiredIncreaseB').textContent = 'N/A';
                document.getElementById('marginA').textContent = 'Marge unitaire: N/A';
                document.getElementById('marginB').textContent = 'Marge unitaire: N/A';
                document.getElementById('annualProfitA').textContent = 'N/A';
                document.getElementById('annualProfitB').textContent = 'N/A';
                document.getElementById('currentSalesVolumeDisplay').textContent = 'N/A';
                document.getElementById('effectivePerte').textContent = 'N/A'; // Update new field

                if (comparisonChart) { comparisonChart.data.datasets[0].data = []; comparisonChart.data.datasets[1].data = []; comparisonChart.update(); }
                if (projectionChart) { projectionChart.data.datasets[0].data = []; projectionChart.data.datasets[1].data = []; projectionChart.update(); }
                if (breakdownAChart) { breakdownAChart.data.datasets[0].data = []; breakdownAChart.update(); }
                if (breakdownBChart) { breakdownBChart.data.datasets[0].data = []; breakdownBChart.update(); }
                if (challengeByCostChart) { challengeByCostChart.data.datasets[0].data = []; challengeByCostChart.update(); }
                return;
            }

            document.getElementById('currentSalesVolumeDisplay').textContent = new Intl.NumberFormat('fr-FR').format(initialSalesVolume);

            const metricsA = calculateMetrics(priceA, initialSalesVolume, costPerKg, fixedCosts, perte, byProductRevenuePerKgReceived);
            const metricsB = calculateMetrics(priceB, initialSalesVolume, costPerKg, fixedCosts, perte, byProductRevenuePerKgReceived);

            document.getElementById('netProfitA').textContent = new Intl.NumberFormat('fr-FR').format(Math.round(metricsA.netProfit)) + ' FCFA';
            document.getElementById('netProfitB').textContent = new Intl.NumberFormat('fr-FR').format(Math.round(metricsB.netProfit)) + ' FCFA';

            let requiredIncrease = 'N/A';
            if (metricsB.unitMargin > 0 && initialSalesVolume > 0) {
                const requiredGrossMarginB = metricsA.netProfit + fixedCosts;
                const requiredQuantityB = requiredGrossMarginB / metricsB.unitMargin;
                const requiredRevenueB = requiredQuantityB * priceB;
                requiredIncrease = (((requiredRevenueB - initialSalesVolume) / initialSalesVolume) * 100).toFixed(1) + '%';
            }
            document.getElementById('requiredIncreaseB').textContent = requiredIncrease;

            comparisonChart.data.datasets[0].data = [metricsA.grossMargin, metricsB.grossMargin];
            comparisonChart.data.datasets[1].data = [metricsA.netProfit, metricsB.netProfit];
            comparisonChart.update();

            const volumes = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            const benefitA = volumes.map(v => calculateMetrics(priceA, v * 1000000, costPerKg, fixedCosts, perte, byProductRevenuePerKgReceived).netProfit);
            const benefitB = volumes.map(v => calculateMetrics(priceB, v * 1000000, costPerKg, fixedCosts, perte, byProductRevenuePerKgReceived).netProfit);

            projectionChart.data.datasets[0].data = benefitA;
            projectionChart.data.datasets[1].data = benefitB;
            projectionChart.update();

            document.getElementById('marginA').textContent = `Une marge unitaire forte de ${new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(metricsA.unitMargin)} FCFA/kg.`;
            document.getElementById('marginB').textContent = `Une marge unitaire plus faible de ${new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(metricsB.unitMargin)} FCFA/kg.`;

            breakdownAChart.data.datasets[0].data = [metricsA.effectiveCostPerKgSold, metricsA.unitMargin];
            breakdownAChart.update();

            breakdownBChart.data.datasets[0].data = [metricsB.effectiveCostPerKgSold, metricsB.unitMargin];
            breakdownBChart.update();

            const costRangeLabels = [];
            const challengeData = [];
            for (let c = 2800; c <= 3500; c += 100) {
                costRangeLabels.push(c + ' FCFA/kg');
                const hypotheticalMetricsA = calculateMetrics(priceA, initialSalesVolume, c, fixedCosts, perte, byProductRevenuePerKgReceived);
                const hypotheticalMetricsB = calculateMetrics(priceB, initialSalesVolume, c, fixedCosts, perte, byProductRevenuePerKgReceived);

                let challengePercentage = null;
                if (hypotheticalMetricsB.unitMargin > 0 && initialSalesVolume > 0 && hypotheticalMetricsA.netProfit + fixedCosts > 0) {
                    const requiredGrossMarginB = hypotheticalMetricsA.netProfit + fixedCosts;
                    const requiredQuantityB = requiredGrossMarginB / hypotheticalMetricsB.unitMargin;
                    const requiredRevenueB = requiredQuantityB * priceB;
                    challengePercentage = (((requiredRevenueB - initialSalesVolume) / initialSalesVolume) * 100);
                    if (challengePercentage === 0) challengePercentage = 0.01;
                } else if (hypotheticalMetricsB.unitMargin <= 0 && hypotheticalMetricsA.netProfit + fixedCosts > 0) {
                     challengePercentage = NaN;
                } else if (hypotheticalMetricsA.netProfit + fixedCosts <= 0) {
                    challengePercentage = 0.01;
                }
                challengeData.push(challengePercentage);
            }
            challengeByCostChart.data.labels = costRangeLabels;
            challengeByCostChart.data.datasets[0].data = challengeData;
            challengeByCostChart.update();

            const annualProfitA = metricsA.netProfit * 12;
            const annualProfitB = metricsB.netProfit * 12;

            document.getElementById('annualProfitA').textContent = new Intl.NumberFormat('fr-FR').format(Math.round(annualProfitA)) + ' FCFA';
            document.getElementById('annualProfitB').textContent = new Intl.NumberFormat('fr-FR').format(Math.round(annualProfitB)) + ' FCFA';

            // Calculate and update effective perte
            let calculatedEffectivePerte = (perte - (byProductRevenuePerKgReceived / costPerKg) * 100);
            if (isNaN(calculatedEffectivePerte) || costPerKg === 0) { // Handle division by zero or invalid inputs
                document.getElementById('effectivePerte').textContent = 'N/A';
            } else {
                document.getElementById('effectivePerte').textContent = calculatedEffectivePerte.toFixed(1) + '%';
            }
        }

        window.onload = function() {
            comparisonChart = new Chart(document.getElementById('comparisonChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Point A', 'Point B'],
                    datasets: [{
                        label: 'Marge Brute (FCFA)',
                        data: [],
                        backgroundColor: colors.blue,
                        datalabels: {
                            align: 'end',
                            anchor: 'end',
                            color: colors.darkBlue,
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: function(value, context) {
                                return new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(value);
                            }
                        }
                    }, {
                        label: 'B√©n√©fice Net (FCFA)',
                        data: [],
                        backgroundColor: colors.green,
                        datalabels: {
                            align: 'end',
                            anchor: 'end',
                            color: colors.darkBlue,
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: function(value, context) {
                                return new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(value);
                            }
                        }
                    }]
                },
                options: { ...tooltipCallback,
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('fr-FR').format(value);
                                }
                            }
                        }
                    },
                    plugins: { ...tooltipCallback.plugins,
                        title: { display: true, text: 'Marge Brute vs. B√©n√©fice Net' }
                    }
                }
            });

            const volumes = [3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
            projectionChart = new Chart(document.getElementById('projectionChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: volumes.map(v => v + 'M FCFA'),
                    datasets: [{
                        label: 'B√©n√©fice Net Point A',
                        data: [],
                        borderColor: colors.blue,
                        backgroundColor: 'rgba(17, 138, 178, 0.1)',
                        fill: true,
                        tension: 0.4,
                        datalabels: {
                            align: function(context) {
                                const value = context.dataset.data[context.dataIndex];
                                return value > 0 ? 'end' : 'start';
                            },
                            anchor: 'end',
                            color: function(context) {
                                const value = context.dataset.data[context.dataIndex];
                                return value > 0 ? colors.blue : colors.red;
                            },
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: function(value, context) {
                                const dataIndex = context.dataIndex;
                                const dataLength = context.dataset.data.length;

                                if (dataIndex === 0 || dataIndex === dataLength - 1) {
                                    return new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(value);
                                }
                                return '';
                            }
                        }
                    }, {
                        label: 'B√©n√©fice Net Point B',
                        data: [],
                        borderColor: colors.red,
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        fill: true,
                        tension: 0.4,
                        datalabels: {
                            align: function(context) {
                                const value = context.dataset.data[context.dataIndex];
                                return value > 0 ? 'end' : 'start';
                            },
                            anchor: 'end',
                            color: function(context) {
                                const value = context.dataset.data[context.dataIndex];
                                return value > 0 ? colors.blue : colors.red;
                            },
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: function(value, context) {
                                const dataIndex = context.dataIndex;
                                const dataLength = context.dataset.data.length;

                                if (dataIndex === 0 || dataIndex === dataLength - 1) {
                                    return new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(value);
                                }
                                return '';
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: { display: true, text: 'B√©n√©fice Net (FCFA)' },
                            ticks: {
                                callback: function(value) {
                                    return new Intl.NumberFormat('fr-FR').format(value);
                                }
                            }
                        },
                        x: {
                            title: { display: true, text: 'Chiffre d\'Affaires' }
                        }
                    },
                    plugins: {
                        tooltip: tooltipCallback.plugins.tooltip,
                        title: { display: true, text: 'Projection de Rentabilit√© par Volume' }
                    }
                }
            });
            
            breakdownAChart = new Chart(document.getElementById('breakdownAChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Co√ªt effectif d\'achat', 'Marge unitaire'],
                    datasets: [{
                        data: [],
                        backgroundColor: [colors.darkBlue, colors.blue],
                        borderColor: '#FFFFFF',
                        borderWidth: 4,
                        datalabels: {
                            color: '#fff',
                            formatter: function(value, context) {
                                return new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(value);
                            }
                        }
                    }]
                },
                options: { ...tooltipCallback,
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { ...tooltipCallback.plugins,
                        legend: { position: 'bottom' }
                    }
                }
            });

            breakdownBChart = new Chart(document.getElementById('breakdownBChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Co√ªt effectif d\'achat', 'Marge unitaire'],
                    datasets: [{
                        data: [],
                        backgroundColor: [colors.darkBlue, colors.red],
                        borderColor: '#FFFFFF',
                        borderWidth: 4,
                        datalabels: {
                            color: '#fff',
                            formatter: function(value, context) {
                                return new Intl.NumberFormat('fr-FR', { minimumFractionDigits: 1, maximumFractionDigits: 1 }).format(value);
                            }
                        }
                    }]
                },
                options: { ...tooltipCallback,
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { ...tooltipCallback.plugins,
                        legend: { position: 'bottom' }
                    }
                }
            });

            challengeByCostChart = new Chart(document.getElementById('challengeByCostChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: '% Augmentation Volume Requis pour Point B',
                        data: [],
                        borderColor: colors.red,
                        backgroundColor: 'rgba(255, 107, 107, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        datalabels: {
                            align: 'end',
                            anchor: 'end',
                            color: colors.darkBlue,
                            font: {
                                size: 10,
                                weight: 'bold'
                            },
                            formatter: function(value, context) {
                                if (isNaN(value)) {
                                    return 'Impossible';
                                } else if (value === 0.01) {
                                    return '0.0%';
                                } else {
                                    return value.toFixed(1) + '%';
                                }
                            }
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'logarithmic',
                            title: { display: true, text: '% Augmentation de Volume' },
                            ticks: {
                                callback: function(value, index, values) {
                                    if (value === 0.01) {
                                        return '0%';
                                    }
                                    const power = Math.log10(value);
                                    if (Number.isInteger(power) || value === 1 || value === 10 || value === 100) {
                                        return value.toLocaleString('fr-FR') + '%';
                                    }
                                    return null;
                                }
                            },
                            min: 0.01
                        },
                        x: {
                            title: { display: true, text: 'Prix d\'Achat (FCFA/kg)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const item = tooltipItems[0];
                                    let label = item.chart.data.labels[item.dataIndex];
                                    if (Array.isArray(label)) {
                                        return label.join(' ');
                                    }
                                    return label;
                                },
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (isNaN(context.parsed.y)) {
                                        label += 'Impossible';
                                    } else if (context.parsed.y === 0.01) {
                                        label += '0.0%';
                                    } else {
                                        label += context.parsed.y.toFixed(1) + '%';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });

            document.getElementById('costPerKg').addEventListener('input', updateInfographic);
            document.getElementById('priceA').addEventListener('input', updateInfographic);
            document.getElementById('priceB').addEventListener('input', updateInfographic);
            document.getElementById('initialSalesVolume').addEventListener('input', updateInfographic);
            document.getElementById('salaries').addEventListener('input', updateInfographic);
            document.getElementById('rent').addEventListener('input', updateInfographic);
            document.getElementById('otherCharges').addEventListener('input', updateInfographic);
            document.getElementById('perte').addEventListener('input', updateInfographic);
            document.getElementById('byProductRevenuePerKgReceived').addEventListener('input', updateInfographic);

            updateInfographic();
        };
    </script>
</body>
</html>
